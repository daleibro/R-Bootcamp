---
title: "R-Bootcamp - Analysis of Building Projects in Zurich"
subtitle: "MSC.IDS - HSLU Lucerne"
author: "Keith Lawless, Daniel Leibrock"
output:
  pdf_document:
    toc: yes
    toc_depth: 3
date: "2022-08-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
data <- read.csv("BAU502OD5023.csv", encoding = "UTF-8")
prices <- read.csv("BAU514OD5142.csv")
location <- read.csv("stzh.adm_statzonen_beschr_p.csv")
```

```{r packages, include=FALSE}
library(dplyr)
library(shiny)
library(knitr)
library(ggplot2)
```

## Introduction to the Analysis

### Selection of the Dataset

The Dataset we want to analyze in the cause of this project, is the "**Neubauwohnungen nach Bauprojektstatus, Eigentumsart und statistischer Zone seit 2009**" Dataset from the opendata.swiss website. The Dataset contains information about housing projects in the city of Zurich since 2009 and holds information such as project status, ownership and location of the project. Furthermore, we add enriching data regarding real estate prices as well as adress data from the City of Zurich Open Data Portal to enrich our main Dataset. 

......

### Goals of the Analysis

The goal of the Analysis is to get an insight into the development of the real estate market in Zurich throughout the past decade. We want to offer a diverse view on several aspects of the market, including the development of different types of projects, prices, owners and locations. This way, we want to identify trends and offer an overview of the market structure.

### Research questions

Following the previous introduction and the goals of our analysis, we aim to answer the following research questions:

1) How did the number of overall building projects develop over time in different statistical zones / quartiers?
2) Who are the main owners / drivers of building projects?
3) Does the share of different building size groups change over time?
4) How did prices in the different quartiers change over time?
5) Is there a relation between price development and building project development visible?

......


## Data Preparation

```{r Prep_Main}
drop_cols_data <- c("StatZoneSort", "QuarSort", "QuarCd", "KreisSort", "KreisCd", "ProjStatusSort", "EigentumsartSort")

datareduced <- data %>%
  select(- all_of(drop_cols_data)) %>%
  group_by(Jahr, KreisLang, QuarLang, StatZoneCd,ProjStatus, Eigentumsart, AnzWhg) %>%
  summarise(WhgSum = sum(AnzWhg))
  #filter(AnzWhg != 0)
head(datareduced, n = 10)

datareduced_2 <- data %>%
  select(- all_of(drop_cols_data)) %>%
  group_by(Jahr, KreisLang) %>%
  summarise(WhgSum = sum(AnzWhg))
  #filter(AnzWhg != 0)
#head(datareduced_2, n = 40)
#str(datareduced)
#write.csv(datareduced, "main.csv", fileEncoding = "UTF-8")
```

```{r Prep_Prices}
drop_cols_prices <- c("QuarCd", "ZoneSort", "FrQmBodenNettoGanzeLieg", "FrQmBodenNettoStwE", "FrQmBodenNettoAlleHA")
price_cols <- c("FrQmBodenGanzeLieg", "FrQmBodenStwE", "FrQmBodenAlleHA", "FrQmWohnflStwE")

pricesreduced <- prices %>%
  select(- all_of(drop_cols_prices)) %>%
  filter(Typ != "Zahl") %>%
  mutate(FrQmBodenGanzeLieg = replace(FrQmBodenGanzeLieg, FrQmBodenGanzeLieg == ".", "")) %>%
  mutate(FrQmBodenStwE = replace(FrQmBodenStwE, FrQmBodenStwE == ".", "")) %>%
  mutate(FrQmBodenAlleHA = replace(FrQmBodenAlleHA, FrQmBodenAlleHA == ".", "")) %>%
  mutate(FrQmWohnflStwE = replace(FrQmWohnflStwE, FrQmWohnflStwE == ".", "")) %>%
  mutate_at(price_cols, as.integer) %>%
  group_by(QuarLang, Jahr) %>%
  summarise_at(price_cols, mean, na.rm = TRUE)
  #summarise("FrQmBodenGanzeLieg_avg" = mean(FrQmBodenGanzeLieg, na.rm = TRUE)) #%>%
  #summarise("FrQmBodenStwE_avg" = mean(FrQmBodenStwE, na.rm = TRUE)) %>%
  #summarise("FrQmBodenAlleHA_avg" = mean(FrQmBodenAlleHA, na.rm = TRUE)) %>%
  #summarise("FrQmWohnflStwE_avg" = mean(FrQmWohnflStwE, na.rm = TRUE))
  
head(pricesreduced, n = 50)
#write.csv(pricesreduced, "pricesreduced.csv", fileEncoding = "UTF-8")
#typeof(prices$FrQmBodenGanzeLieg)
#str(pricesreduced)
```



```{r Prep_Locations}
head(location, n = 10)
```


```{r Merge}
datacomb <- left_join(datareduced, pricesreduced, by = c("QuarLang" = "QuarLang", "Jahr" = "Jahr"))
head(datacomb, n = 10)
datafinal <- left_join(datacomb, location, by = c("StatZoneCd" = "kuerzel"))
head(datafinal, n = 10)
#write.csv(datafinal, "datafinal.csv", encoding = "UTF-8")
#readr::write_excel_csv(datafinal, "datafinal.csv")
```

```{r}
#write.csv(datacomb, "dq.csv")
```


## Exploratory Data Analysis

```{r EDA}
#head(data)
#str(data)
#summary(data)
```

## Visual Data Analysis

```{r Test}
testplot <-
  ggplot(data = datareduced_2,
         mapping = aes(y = WhgSum, x = Jahr, colour = KreisLang)) + geom_line()

testplot
```

### Basic visual Analysis / ggplot2

```{r VDA}

```

### Special Topic: Mapping / Shiny

```{r VDA_2}
final testing
```

## Modelling and Prediction

### Model XYZ

```{r Model}

```

### Prediction XYZ

```{r Prediction}

```

## Summary and Conclusion

